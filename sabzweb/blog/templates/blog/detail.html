{% extends 'parent/base.html' %}
{% load static %}
{% load blog_tags %}
{% load jformat %}
{% load form_filters %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- پیام موفقیت فقط اگر کامنت ثبت شده -->
  {% if comment %}
    <div class="alert alert-success text-center">
      ✅ کامنت شما ثبت شد.
      <a href="{{ post.get_absolute_url }}" class="btn btn-outline-primary btn-sm ms-2">بازگشت به پست</a>
    </div>
  {% endif %}

  <!-- محتوا -->
  <h1 class="mb-3">{{ post.title }}</h1>
  <p class="text-muted">
    دسته: <strong>{{ post.category }}</strong> |
    نویسنده: <strong>{{ post.author }}</strong> |
    تاریخ: <strong>{{ post.publish|jformat:"%Y/%m/%d - %H:%M" }}</strong>
  </p>

  <!-- توضیحات -->
  <div class="mb-4">
    {{ post.description|markdown }}
  </div>

  <!-- تصاویر پست -->
  <div class="row g-3 mb-5">
    {% for img in post.images.all %}
      <div class="col-md-4">
        <img src="{{ img.image_file.url }}" class="img-fluid rounded" alt="{{ img.title }}">
      </div>
    {% endfor %}
  </div>

  <!-- نمایش دیدگاه‌ها -->
  <h4 class="mb-3">{{ comments.count }} دیدگاه</h4>
  {% for cm in comments %}
    <div class="d-flex mb-3">
      <img src="{% static 'images/avatar/av1.png' %}" class="rounded-circle me-3" width="50" height="50">
      <div class="bg-light p-3 rounded w-100 shadow-sm">
        <div class="d-flex justify-content-between mb-1">
          <strong>{{ cm.name }}</strong>
          <small class="text-muted">{{ cm.created|jformat:"%Y/%m/%d - %H:%M" }}</small>
        </div>
        <p class="mb-0">{{ cm.body|linebreaks }}</p>
      </div>
    </div>
  {% empty %}
    <p class="text-muted">هنوز دیدگاهی ثبت نشده است.</p>
  {% endfor %}

  <!-- فرم ارسال دیدگاه -->
  <div class="mt-5">
    <h5>ثبت دیدگاه جدید</h5>
    <form method="post" action="{% url 'blog:post_comment' post.id %}" class="mt-3 border p-3 rounded bg-light shadow-sm">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary mt-2">ثبت</button>
    </form>
  </div>

</div>
{% endblock %}
